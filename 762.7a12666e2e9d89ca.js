"use strict";(self.webpackChunkannouncement_portal=self.webpackChunkannouncement_portal||[]).push([[762],{9615:(g,A,c)=>{c.d(A,{X:()=>m});var d=c(4946),h=c(5123),u=c(7879);let m=(()=>{class o{constructor(e){this.hierarchicalAdminService=e,this.STORAGE_KEY="announcement-portal-announcements",this.announcements=(0,d.tdS)(this.loadAnnouncements()),this.announcements$=this.announcements.asReadonly()}loadAnnouncements(){const e=localStorage.getItem(this.STORAGE_KEY);let t=e?JSON.parse(e):[];if(t=t.map(i=>{if(!i.createdBy){const r=this.hierarchicalAdminService.getAdminById("admin-legacy");return{...i,createdBy:r||{id:"system",username:"system",email:"system@announcement.com",fullName:"System Administrator",role:h.P[2],department:"IT Division",isActive:!0,createdAt:new Date,password:""},isPublic:void 0===i.isPublic||i.isPublic,priority:i.priority||"medium"}}return i}),0===t.length){const i=this.hierarchicalAdminService.getAdminById("admin-legacy");t.push({id:"1",title:"\u0938\u094d\u0935\u093e\u0917\u0924 \u0939\u0948 UPID \u0938\u0942\u091a\u0928\u093e \u092a\u094b\u0930\u094d\u091f\u0932 \u092e\u0947\u0902! | Welcome to UPID Suchana Portal!",content:"\u092f\u0939 \u092a\u094b\u0930\u094d\u091f\u0932 \u0909\u0924\u094d\u0924\u0930 \u092a\u094d\u0930\u0926\u0947\u0936 \u0938\u093f\u0902\u091a\u093e\u0908 \u0935\u093f\u092d\u093e\u0917 \u0915\u0947 \u0938\u092d\u0940 \u0938\u094d\u0924\u0930\u094b\u0902 \u092a\u0930 \u092a\u0926\u093e\u0928\u0941\u0915\u094d\u0930\u092e\u093f\u0924 \u0938\u0902\u091a\u093e\u0930 \u0915\u094b \u0938\u0915\u094d\u0937\u092e \u092c\u0928\u093e\u0924\u093e \u0939\u0948\u0964 \u0905\u0927\u093f\u0915\u093e\u0930\u0940 \u0935\u0930\u093f\u0937\u094d\u0920\u0924\u093e \u0915\u0947 \u0906\u0927\u093e\u0930 \u092a\u0930 \u0909\u092a\u092f\u0941\u0915\u094d\u0924 \u092a\u0939\u0941\u0902\u091a \u0928\u093f\u092f\u0902\u0924\u094d\u0930\u0923 \u0915\u0947 \u0938\u093e\u0925 \u092e\u0939\u0924\u094d\u0935\u092a\u0942\u0930\u094d\u0923 \u0905\u092a\u0921\u0947\u091f, \u0926\u0938\u094d\u0924\u093e\u0935\u0947\u091c\u093c \u0914\u0930 \u092a\u0930\u093f\u092a\u0924\u094d\u0930 \u0938\u093e\u091d\u093e \u0915\u0930 \u0938\u0915\u0924\u0947 \u0939\u0948\u0902\u0964 | This portal enables hierarchical communication across all levels of the UP Irrigation Department. Officers can share important updates, documents, and circulars with appropriate access controls based on seniority.",createdAt:new Date,updatedAt:new Date,likes:0,likedBy:[],attachments:[],createdBy:i||{id:"system",username:"system",email:"system@announcement.com",fullName:"System Administrator",role:h.P[2],department:"IT Division",isActive:!0,createdAt:new Date,password:""},isPublic:!0,priority:"high"}),this.saveAnnouncements(t)}return t}saveAnnouncements(e){const t=e||this.announcements();localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}getLatestAnnouncement(){const e=this.announcements();return e.length>0?e[e.length-1]:null}getAllAnnouncements(){return this.announcements()}getAnnouncementById(e){return this.announcements().find(i=>i.id===e)||null}createOrUpdateAnnouncement(e,t,i=[],r){const a=new Date,s=r||this.hierarchicalAdminService.getCurrentAdmin(),l=this.getLatestAnnouncement();if(!s)throw new Error("No authenticated admin found");if(l){if(!this.canEditAnnouncement(l,s))throw new Error("You do not have permission to edit this announcement");{const f={...l,title:e.trim(),content:t.trim(),updatedAt:a,attachments:i};this.announcements.update(y=>y.map(w=>w.id===l.id?f:w))}}else{const f={id:Date.now().toString(),title:e.trim(),content:t.trim(),createdAt:a,updatedAt:a,likes:0,likedBy:[],attachments:i,createdBy:s,isPublic:!0,priority:"medium"};this.announcements.update(y=>[...y,f])}return this.saveAnnouncements(),this.getLatestAnnouncement()}createNewAnnouncement(e,t,i=[],r="medium",a=!0){const s=new Date,l=this.hierarchicalAdminService.getCurrentAdmin();if(!l)throw new Error("No authenticated admin found");const p={id:Date.now().toString(),title:e.trim(),content:t.trim(),createdAt:s,updatedAt:s,likes:0,likedBy:[],attachments:i,createdBy:l,isPublic:a,priority:r};return this.announcements.update(f=>[...f,p]),this.saveAnnouncements(),p}updateAnnouncement(e,t,i,r=[]){const a=new Date;let s=null;return this.announcements.update(l=>l.map(p=>p.id===e?(s={...p,title:t.trim(),content:i.trim(),updatedAt:a,attachments:r},s):p)),this.saveAnnouncements(),s}deleteAnnouncement(e){const t=this.announcements().length;return this.announcements.update(i=>i.filter(r=>r.id!==e)),this.saveAnnouncements(),this.announcements().length<t}deleteLatestAnnouncement(){const e=this.getLatestAnnouncement();return!!e&&this.deleteAnnouncement(e.id)}toggleLike(e,t){let i=!1;return this.announcements.update(r=>r.map(a=>a.id===e?a.likedBy.indexOf(t)>-1?{...a,likes:a.likes-1,likedBy:a.likedBy.filter(l=>l!==t)}:(i=!0,{...a,likes:a.likes+1,likedBy:[...a.likedBy,t]}):a)),this.saveAnnouncements(),i}hasUserLiked(e,t){const i=this.announcements().find(r=>r.id===e);return!!i&&i.likedBy.includes(t)}hasAnnouncements(){return this.announcements().length>0}syncFileDownloads(e){this.announcements.update(t=>t.map(i=>({...i,attachments:i.attachments.map(r=>{const a=e.getFile(r.id);return a?{...r,downloads:a.downloads}:r})}))),this.saveAnnouncements()}updateFileDownloadCount(e){this.announcements.update(t=>t.map(i=>({...i,attachments:i.attachments.map(r=>r.id===e?{...r,downloads:r.downloads+1}:r)}))),this.saveAnnouncements()}clearAllData(){this.announcements.set([]),localStorage.removeItem(this.STORAGE_KEY)}getAnnouncementsForCurrentAdmin(){const e=this.hierarchicalAdminService.getCurrentAdmin();return e?this.announcements().filter(t=>this.hierarchicalAdminService.canViewAnnouncement(e,t.createdBy)):[]}getSubordinateAnnouncements(){const e=this.hierarchicalAdminService.getCurrentAdmin();return e?this.announcements().filter(t=>t.createdBy.role.seniorityLevel>e.role.seniorityLevel):[]}getAnnouncementsByOfficer(e){return this.announcements().filter(t=>t.createdBy.id===e)}canEditAnnouncement(e,t){return this.hierarchicalAdminService.canEditAnnouncement(t,e.createdBy)}canDeleteAnnouncement(e,t){return this.hierarchicalAdminService.canDeleteAnnouncement(t,e.createdBy)}canViewAnnouncement(e,t){return this.hierarchicalAdminService.canViewAnnouncement(t,e.createdBy)}getAnnouncementsByDepartment(e){return this.announcements().filter(t=>t.createdBy.department===e)}getAnnouncementsByPriority(e){return this.announcements().filter(t=>t.priority===e)}getPublicAnnouncements(){return this.announcements().filter(e=>e.isPublic)}}return o.\u0275fac=function(e){return new(e||o)(d.LFG(u.X))},o.\u0275prov=d.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},6644:(g,A,c)=>{c.d(A,{I:()=>u});var d=c(5861),h=c(4946);let u=(()=>{class m{constructor(){this.FILE_STORAGE_KEY="announcement-portal-files",this.FILE_ANALYTICS_KEY="announcement-portal-file-analytics",this.files=(0,h.tdS)(this.loadFiles()),this.analytics=(0,h.tdS)(this.loadAnalytics()),this.files$=this.files.asReadonly(),this.analytics$=this.analytics.asReadonly()}loadFiles(){const n=localStorage.getItem(this.FILE_STORAGE_KEY);return n?JSON.parse(n):[]}loadAnalytics(){const n=localStorage.getItem(this.FILE_ANALYTICS_KEY);return n?JSON.parse(n):[]}saveFiles(){localStorage.setItem(this.FILE_STORAGE_KEY,JSON.stringify(this.files()))}saveAnalytics(){localStorage.setItem(this.FILE_ANALYTICS_KEY,JSON.stringify(this.analytics()))}uploadFile(n){var e=this;return(0,d.Z)(function*(){return new Promise((t,i)=>{if(n.size>10485760)return void i(new Error("File size exceeds 10MB limit"));const r=new FileReader;r.onload=()=>{const a={id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:e.sanitizeFileName(n.name),originalName:n.name,type:n.type||e.getFileTypeFromExtension(n.name),size:n.size,data:r.result,uploadedAt:new Date,downloads:0,views:0,downloadedBy:[],viewedBy:[]};e.files.update(l=>[...l,a]),e.saveFiles();const s={fileId:a.id,fileName:a.originalName,totalDownloads:0,totalViews:0,downloadHistory:[],viewHistory:[]};e.analytics.update(l=>[...l,s]),e.saveAnalytics(),t(a)},r.onerror=()=>{i(new Error("Failed to read file"))},r.readAsDataURL(n)})})()}getFile(n){return this.files().find(e=>e.id===n)||null}getFilesByIds(n){return this.files().filter(e=>n.includes(e.id))}deleteFile(n){const e=this.files().length;return this.files.update(t=>t.filter(i=>i.id!==n)),this.analytics.update(t=>t.filter(i=>i.fileId!==n)),this.saveFiles(),this.saveAnalytics(),this.files().length<e}viewFile(n,e,t,i){this.getFile(n)&&(this.files.update(a=>a.map(s=>{if(s.id===n){const l=s.viewedBy.includes(e);return{...s,views:l?s.views:s.views+1,viewedBy:l?s.viewedBy:[...s.viewedBy,e]}}return s})),this.analytics.update(a=>a.map(s=>{if(s.fileId===n){const l={userId:e,userName:t,userEmail:i,timestamp:new Date,action:"view"};return{...s,totalViews:s.totalViews+1,lastViewed:new Date,viewHistory:[...s.viewHistory,l]}}return s})),this.saveFiles(),this.saveAnalytics())}downloadFile(n,e,t,i){const r=this.getFile(n);r&&(this.files.update(a=>a.map(s=>{if(s.id===n){const l=s.downloadedBy.includes(e);return{...s,downloads:s.downloads+1,downloadedBy:l?s.downloadedBy:[...s.downloadedBy,e]}}return s})),this.analytics.update(a=>a.map(s=>{if(s.fileId===n){const l={userId:e,userName:t,userEmail:i,timestamp:new Date,action:"download"};return{...s,totalDownloads:s.totalDownloads+1,lastDownloaded:new Date,downloadHistory:[...s.downloadHistory,l]}}return s})),this.saveFiles(),this.saveAnalytics(),this.onDownloadCallback&&this.onDownloadCallback(n),this.triggerFileDownload(r))}setDownloadCallback(n){this.onDownloadCallback=n}triggerFileDownload(n){const e=document.createElement("a");e.href=n.data,e.download=n.originalName,document.body.appendChild(e),e.click(),document.body.removeChild(e)}getFileAnalytics(n){return this.analytics().find(e=>e.fileId===n)||null}getAllAnalytics(){return this.analytics()}getFileIcon(n){const e=n.toLowerCase();return e.includes("pdf")?"bi-file-earmark-pdf":e.includes("excel")||e.includes("spreadsheet")||e.includes("sheet")?"bi-file-earmark-excel":e.includes("word")||e.includes("document")?"bi-file-earmark-word":e.includes("powerpoint")||e.includes("presentation")?"bi-file-earmark-ppt":e.includes("image")||e.includes("jpeg")||e.includes("jpg")||e.includes("png")||e.includes("gif")?"bi-file-earmark-image":e.includes("video")?"bi-file-earmark-play":e.includes("audio")?"bi-file-earmark-music":e.includes("text")?"bi-file-earmark-text":e.includes("zip")||e.includes("rar")||e.includes("archive")?"bi-file-earmark-zip":"bi-file-earmark"}formatFileSize(n){if(0===n)return"0 Bytes";const i=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,i)).toFixed(2))+" "+["Bytes","KB","MB","GB"][i]}sanitizeFileName(n){return n.replace(/[^a-zA-Z0-9.-]/g,"_")}getFileTypeFromExtension(n){const e=n.split(".").pop()?.toLowerCase();return{pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",txt:"text/plain",zip:"application/zip",rar:"application/x-rar-compressed"}[e||""]||"application/octet-stream"}clearAllData(){this.files.set([]),this.analytics.set([]),localStorage.removeItem(this.FILE_STORAGE_KEY),localStorage.removeItem(this.FILE_ANALYTICS_KEY)}}return m.\u0275fac=function(n){return new(n||m)},m.\u0275prov=h.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},3076:(g,A,c)=>{c.d(A,{K:()=>h});var d=c(4946);let h=(()=>{class u{constructor(){this.STORAGE_KEY="announcement-portal-users",this.CURRENT_USER_KEY="announcement-portal-current-user",this.users=(0,d.tdS)(this.loadUsers()),this.currentUser=(0,d.tdS)(this.loadCurrentUser()),this.users$=this.users.asReadonly(),this.currentUser$=this.currentUser.asReadonly(),this.viewedUsers=(0,d.Flj)(()=>this.users().filter(o=>o.hasViewed))}loadUsers(){const o=localStorage.getItem(this.STORAGE_KEY);return o?JSON.parse(o):[]}loadCurrentUser(){const o=localStorage.getItem(this.CURRENT_USER_KEY);return o?JSON.parse(o):null}saveUsers(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.users()))}saveCurrentUser(){localStorage.setItem(this.CURRENT_USER_KEY,JSON.stringify(this.currentUser()))}createUser(o,n){const e=this.users().find(i=>i.email===n);if(e)return this.currentUser.set(e),this.saveCurrentUser(),e;const t={id:Date.now().toString(),name:o.trim(),email:n.trim().toLowerCase(),hasLiked:!1,hasViewed:!1,viewedAt:new Date};return this.users.update(i=>[...i,t]),this.currentUser.set(t),this.saveUsers(),this.saveCurrentUser(),t}markAsViewed(o){this.users.update(n=>n.map(e=>e.id===o?{...e,hasViewed:!0,viewedAt:new Date}:e)),this.saveUsers()}toggleLike(o){let n=!1;return this.users.update(e=>e.map(t=>t.id===o?(n=!t.hasLiked,{...t,hasLiked:n}):t)),this.saveUsers(),n}getCurrentUser(){return this.currentUser()}logout(){this.currentUser.set(null),localStorage.removeItem(this.CURRENT_USER_KEY)}getUserById(o){return this.users().find(n=>n.id===o)}clearAllData(){this.users.set([]),this.currentUser.set(null),localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.CURRENT_USER_KEY)}}return u.\u0275fac=function(o){return new(o||u)},u.\u0275prov=d.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);